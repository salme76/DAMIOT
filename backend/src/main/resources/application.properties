# =====================================================
# CONFIGURACION BACKEND DAMIOT
# Autor: Emilio Jose Salmeron Arjona
# IES Azarquiel - Toledo
# CFGS Desarrollo de Aplicaciones Multiplataforma
# Curso 2025/2026
# =====================================================

# Nombre de la aplicacion
spring.application.name=DAMIOT Backend

# =====================================================
# CONFIGURACION DEL SERVIDOR
# =====================================================
server.port=8080
server.address=0.0.0.0

# =====================================================
# CONFIGURACION DE BASE DE DATOS MYSQL
# =====================================================
# Con UTC (hora de Espana)
spring.datasource.url=jdbc:mysql://localhost:3306/damiot_db?useSSL=false&serverTimezone=Europe/Madrid&allowPublicKeyRetrieval=true&connectTimeout=5000&socketTimeout=30000
spring.datasource.username=root
spring.datasource.password=
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# HikariCP - Pool de conexiones resiliente
spring.datasource.hikari.minimum-idle=0
spring.datasource.hikari.maximum-pool-size=10
spring.datasource.hikari.connection-timeout=5000
spring.datasource.hikari.validation-timeout=3000
spring.datasource.hikari.idle-timeout=300000
spring.datasource.hikari.max-lifetime=600000
spring.datasource.hikari.initialization-fail-timeout=-1

# JPA/Hibernate
spring.jpa.hibernate.ddl-auto=none
spring.jpa.show-sql=false
spring.jpa.open-in-view=false
spring.jpa.properties.hibernate.format_sql=false
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQLDialect

# =====================================================
# CONFIGURACION MQTT (topics en espanol con soporte multi-dispositivo)
# =====================================================
mqtt.broker.url=tcp://192.168.8.136:1883
mqtt.client.id=damiot-backend
mqtt.username=
mqtt.password=

# Topics MQTT para suscripcion (en espanol)
# Formato con MAC: damiot/{categoria}/{MAC}/{sensor/actuador}
# Wildcards MQTT:
#   + = un nivel (ej: +/temperatura matchea solo un nivel)
#   # = multiples niveles (ej: sensores/# matchea todos los subniveles)
mqtt.topics.subscribe=damiot/sensores/#,damiot/actuadores/+/+/estado,damiot/heartbeat/+,damiot/dispositivo/estado

# Topics especificos (referencia con MAC)
# Sensores: damiot/sensores/{MAC}/temperatura
mqtt.topic.temperatura=damiot/sensores/+/temperatura
mqtt.topic.humedad=damiot/sensores/+/humedad

# Actuadores: damiot/actuadores/{MAC}/led_azul/estado
mqtt.topic.led.status=damiot/actuadores/+/led_azul/estado

# Heartbeat: damiot/heartbeat/{MAC}
mqtt.topic.heartbeat=damiot/heartbeat/+

# Topics MQTT para publicacion (se construyen dinamicamente con la MAC)
# Ejemplo: damiot/actuadores/7C:9E:BD:F1:DA:E4/led_azul
mqtt.topic.led.command=damiot/actuadores/{MAC}/led_azul

# =====================================================
# LOGGING
# =====================================================
logging.level.root=INFO
logging.level.com.damiot.backend=DEBUG
logging.level.com.damiot.backend.scheduler=INFO
logging.level.org.springframework.integration.mqtt=WARN
logging.level.com.zaxxer.hikari=ERROR
logging.level.com.zaxxer.hikari.pool.PoolBase=ERROR
logging.level.com.zaxxer.hikari.pool.HikariPool=ERROR
logging.level.org.hibernate=WARN
logging.level.org.hibernate.engine.jdbc.spi.SqlExceptionHelper=ERROR

# =====================================================
# CONFIGURACION DE CORS (para la app Android)
# =====================================================
cors.allowed.origins=*
